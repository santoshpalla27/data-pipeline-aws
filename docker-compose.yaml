services:
  pricing-downloader:
    build:
      context: ./aws-pricing-downloader
      dockerfile: Dockerfile
    image: aws-pricing-downloader:2.0.0
    container_name: aws-pricing-downloader

    # Mount to /app/data/aws_pricing (where config writes by default)
    volumes:
      - ./data/aws_pricing:/app/data/aws_pricing:rw
      - ./metrics:/app/metrics:rw
      - ./services.txt:/app/services.txt:ro

    environment:
      - PYTHONUNBUFFERED=1
      - LOG_LEVEL=INFO

    # Use services.txt dynamically
    entrypoint: [ "/bin/sh", "-c" ]
    command: "aws-price download --no-verify --services $(cat /app/services.txt)"

    restart: "no"

    logging:
      driver: "json-file"
      options:
        max-size: "10m"
        max-file: "3"
