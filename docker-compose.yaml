version: '3.8'

services:
  pricing-downloader:
    build:
      context: ./aws-pricing-downloader
      dockerfile: Dockerfile
    image: aws-pricing-downloader:2.0.0
    container_name: aws-pricing-downloader

    # Use Docker volumes (persistent)
    volumes:
      - pricing-data:/data/aws_pricing
      - pricing-metrics:/metrics
      - ./services.txt:/app/services.txt:ro

    environment:
      - PYTHONUNBUFFERED=1
      - LOG_LEVEL=INFO

    command: >
      download --services AmazonEC2 AmazonECS AmazonEKS AWSLambda AmazonVPC AWSELB AmazonCloudFront AmazonRoute53 AmazonApiGateway AmazonS3 AmazonRDS AmazonDynamoDB AmazonElastiCache AmazonEFS AmazonMQ AmazonMSK AWSWAFv2 AWSShield AWSSecretsManager AWSSystemsManager awskms AmazonCloudWatch AWSCloudTrail AWSXRay AmazonES AWSConfig AmazonSQS AmazonSNS AWSStepFunctions AWSCodePipeline AWSCodeBuild AWSCodeDeploy AmazonEventBridge

    restart: "no"

    logging:
      driver: "json-file"
      options:
        max-size: "10m"
        max-file: "3"

volumes:
  pricing-data:
    driver: local
  pricing-metrics:
    driver: local
